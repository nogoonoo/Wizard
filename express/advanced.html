
<title>Advanced Settings</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css">
<style type="text/css">
    div.time span {
    display: inline-block;
    width: 160px;
}
div.time {
    padding: 5px;
}
input[type="time"]{
    width:110px
}


</style>
<script src="/js/nav.js"></script>
<script src="/js/util.js"></script>
<script src="/js/micromodal.min.js"></script>

<body>
    <div class="menu-container" onclick="toggleMenu(this)">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </div>
	<div class="sidebar" id="sidebar"></div>
	<div class="content">

<h2>Advanced</h2>
<form action="/advanced" method="post" onsubmit="disableSave();">
    <label class="fieldName info" data-info="sys-power">Power Options</label>
    <div class="formField">
        <div class="time start"><span>Turn screen on daily at</span><input type="time" id="startTime" value="07:00" onchange="showHideSave()" name="starttime"></div>
        <div class="time end"><span>Turn screen off daily at</span><input type="time" id="endTime" value="22:00" onchange="showHideSave()" name="endtime"></div>
    </div>
    <!--<label class="fieldName">Reset Options</label>
    <div class="formField">
        reset mirror
        
    </div>-->
    <label class="fieldName inline notop info" data-info="sys-updates">Updates</label>
    <div class="formField inline">
        <button type="button" onclick="checkforupdate(this)" class="function">Check For Updates</button>
        <span id="updateMessage"></span>
    </div>
    <div style="height:20px"></div>
    <label class="fieldName inline notop">System</label>
    <div class="formField inline">
        <button type="button" onclick="powerDialog('reboot')" class="function">Reboot</button>
        <button type="button" onclick="powerDialog('shutdown')" class="function">Power Off</button>
    </div>

    <div style="height:20px"></div>

    <div class="formField">
        <button type="submit" id="savebutton" disabled>Save Settings</button>
        <button type="button" id="refreshbutton" class="" onclick="openMM(this)">Return to Greenscreen</button>
    </div>

	</form>
	<div id="status"></div>

	<dialog id="dialogBox">
		<header>
		  <h2 class="header">Confirmation</h2>
		  <button onclick="closeDialog()" id="closeDialogHeader">&#x2716</button>
		</header>
		<section>
		  <p id="dialogMsg">Are you sure you want to reboot your Greenscreen?</p>
		</section>
		<footer>
		  <button onclick="closeDialog()" id="closeDialogFooter">Cancel</button>
		  <button onclick="powerFunction()" id="deleteButton">Reboot</button>
		</footer>
	  </dialog>

    </div>
    <span class="qrCode hidden" id="qrParent"><img id="qr-code" src=""><div id="">Scan QR code, or visit</div><div id="hostnameInfo"></div></span>
    <div class="modal micromodal-slide" id="info-modal" aria-hidden="true">
        <div class="modal__overlay" tabindex="-1" data-micromodal-close>
          <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="info-modal-title">
            <header class="modal__header">
              <h2 class="modal__title" id="info-modal-title">
                Remove Images
              </h2>
              <button class="modal__close" aria-label="Close modal" data-micromodal-close></button>
            </header>
            <main class="modal__content" id="info-modal-content">
              CONTENT GOES HERE
            </main>
            <footer class="modal__footer">
              <button class="modal__btn" data-micromodal-close aria-label="Close this dialog window">Close</button>
            </footer>
          </div>
        </div>
    </div>

<script>
	let showSave = false;
	let saveButton = document.getElementById("savebutton");

	
    function validateForm(){
        if(document.getElementById('savedLocationName').innerText.length<1 && document.getElementById('addresslookup').value.length<1){
            document.getElementById('locationerror').style.display='block';
            return false;
        }
        else
            return true;
    }
 
    async function loadData(){
        const response = await fetch("/fetchadvanced");
		const myData = await response.json();
        //console.log(myData);
 
        if(myData.onTime.trim().length>0){
            document.getElementById('startTime').value = myData.onTime;
        }
        if(myData.offTime.length>0){
            document.getElementById('endTime').value = myData.offTime;
        }
     
    }

    function checkforupdate(obj){
        obj.innerText = "Checking for updates...";
        obj.disabled = true;
        checkForUpdates();
    }
    async function checkForUpdates(){

    const response = await fetch("/updatewizard");
		const myData = await response.json()
        console.log(myData);
        let result = "";
        if(myData.status.indexOf('error:')>-1){
            result = "There was an error checking for an update"
        }
        if(myData.status.indexOf('current')>-1){
            result = "Your Greenscreen is up to date"
        }
        if(myData.status.indexOf('behind')>-1){
            result = "An update is available"
        }
        document.getElementById('updateMessage').innerText = result;
}
	function showHideSave(){
		saveButton.disabled = false;
	}
    function hideSave(){
        saveButton.innerText = "saving...";
        saveButton.disabled = disabled;
    }
    dialogBoxId=document.getElementById("dialogBox")
    let pwrFunc = "reboot";

    function powerDialog(option){
        let dialogMsg = document.getElementById('dialogMsg');
        let actionButton = document.getElementById('deleteButton');
        if(option == 'reboot'){
            dialogMsg.innerText = "Are you sure you want to reboot Greenscreen?"
            actionButton.innerText = "Yes, Reboot";
            pwrFunc = "reboot";
        }
        if(option == 'shutdown'){
            dialogMsg.innerText = "Are you sure you want to shutdown Greenscreen?"
            actionButton.innerText = "Yes, Shutdown";
            pwrFunc = "shutdown";
        }
        dialogBoxId.addEventListener("keydown", (e) => {
            if (e.key === "Escape") {
                e.preventDefault();
            }
        });
        dialogBoxId.showModal();
    }

    function powerFunction(){
        if(pwrFunc == "reboot")
            reboot();
        if(pwrFunc == "shutdown")
            shutdown();
    }

    async function shutdown(){
        const response = await fetch('/screen-shutdown', {
                method: "POST", 
            }).then((res)=>
            {
                //document.getElementById('filemessage').innerText = "Upload complete";
            });
    }

    async function reboot(){
        const response = await fetch('/screen-reboot', {
                method: "POST", 
            }).then((res)=>
            {
                //document.getElementById('filemessage').innerText = "Upload complete";
            });
    }

	loadNav();
    init();
    loadData();

	</script>



    </body>
</html>
